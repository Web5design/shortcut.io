<html>

  <head>
    <title>Hello</title>
    <style>
      body {
        background-color: #ffffff;
        padding: 0px;
        margin: 20px;
      }

      div#bookmarklet_wrapper input, div#bookmarklet_wrapper textarea{
        font-size: 18px;
        width: 420px;
        border: solid 1px #9b9b9b;
        -moz-border-radius: 3px;
        -webkit-border-radius: 3px;
        border-radius: 3px;
        padding: 5px;
        font-family: Helvetica;

      }

      div#bookmarklet_wrapper input[type=submit] {
        border: 1px solid #b9b9b9;
        background-color: #a6cc64;
        font-size: 18px;
        color: #3e3e3e;
        padding: 10 20 10 20px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border-radius: 5px;
        background:-webkit-gradient(linear; 0% 20%, 0% 100%, from(#dddddd), to(#b1b1b1));
      }

    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="http://smyck.net/bookmarquis/jquery.ba-postmessage.min.js" type="text/javascript" charset="utf-8"></script>

  </head>

  <body>
    <div id="bookmarklet_wrapper">
      <form action='#'>
        <p><input id="url" name="[url]uri" type='url' value='' /></p>
        <p><input id="title" name="[url]title" type='text', value='' /></p>
        <p><textarea name="[url]description" autofocus></textarea></p>
        <p><input type='text' name="[url]tags" placeholder='tags - comma separated' /></p>
        <input id='referrer' type='hidden' name='[url]referrer' />
        <p><input id='send_button' type='submit' value='Add Bookmark' /></p>
      </form>
      <p><div id="close_button" style="width: 30px; height: 30px; background-color: yellow">close</div></p>
    </div>

    <script>
      var foo = "";
      $(document).ready( function() {
        var origin = location.href.split("#")[1];

        $.postMessage(
          'meta_data',
          origin,
          parent
        );

        document.getElementById('url').setAttribute('value', origin);

        var token_regexp = /\b\?auth_token\=(.+)\#\b/

        if ( match = token_regexp.exec(location.href) ) {
          var token = match[1];
        }

        $("#close_button").bind("click", function() {
          $.postMessage(
            'close',
            origin,
            parent
          );
        });

        $('#send_button').bind('click', function() {
          $.ajax({
            type: "POST",
            dataType: "json",
            url: "/urls?auth_token=" + token,
            data: $('form').serialize(),
            success: function(msg){
              alert(msg.status+"\n"+msg.message);
            }
          });

          return false;
        });
      });

      $.receiveMessage(
        function(message){
          meta_data = $.parseJSON(message.data)
          $('input#title').val(unescape(meta_data.page_title));
          $('input#referrer').val(decodeURIComponent(meta_data.referrer));
        }
      );
    </script>
  </body>

</html>
